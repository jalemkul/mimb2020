* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) VERSION on Sep, 25. 2014.
* SETUP PERIODIC BOUNDARY CONDITION 
* 

DIMENS CHSIZE 1000000

iofo exte

! Read topology and parameter files
stream toppar.str

!Read PSF and Coordinates 
open read unit 10 card name step3_pbcsetup.psf
read psf  xplor unit 10 card

open read unit 10 card name step3_pbcsetup.crd
read coor unit 10 card

stream step3_pbcsetup.str

open read unit 10 card name crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele resname TIP3 end
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele ( segid @posid .or. segid @negid ) end

nbonds atom vatom vfswitch bycb -
       ctonnb 10.0 ctofnb 12.0 cutnb 16.0 cutim 16.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 -
       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
energy

mini SD   nstep 500 nprint 50
mini ABNR nstep 500 nprint 50 tolgrd 0.0001

open write unit 10 card name step4_mini.pdb
write coor unit 10 pdb  

open write unit 10 card name step4_mini.crd
write coor unit 10 card

stop
